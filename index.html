<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolos de Actuaci贸n Piscinas - Calculadora Pedrosa</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #ffffff;
            color: #2c3e50;
            padding: 40px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            color: #1a365d;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
            font-weight: 400;
        }

        .main-content {
            padding: 40px;
        }

        .section-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .section-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            border-color: #cbd5e0;
        }

        .section-card.active {
            border-color: #3b82f6;
            background: #f8fafc;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .section-card.emergency {
            border-left: 4px solid #ef4444;
        }

        .section-card.emergency.active {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .section-card.correction {
            border-left: 4px solid #22c55e;
        }

        .section-card.correction.active {
            border-color: #22c55e;
            background: #f0fdf4;
        }

        .section-card.report {
            border-left: 4px solid #8b5cf6;
        }

        .section-card.report.active {
            border-color: #8b5cf6;
            background: #faf5ff;
        }

        .section-card.protocols {
            border-left: 4px solid #f59e0b;
        }

        .section-card.protocols.active {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .section-card.orders {
            border-left: 4px solid #06b6d4;
        }

        .section-card.orders.active {
            border-color: #06b6d4;
            background: #ecfeff;
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .card-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .protocol-selector {
            display: none;
            margin-bottom: 30px;
        }

        .protocol-selector.active {
            display: block;
        }

        .protocol-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .protocol-btn {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .protocol-btn:hover {
            border-color: #2a5298;
            transform: translateY(-2px);
        }

        .protocol-btn.active {
            border-color: #2a5298;
            background: #f8f9ff;
        }

        .protocol-btn.solid-feces { border-left: 6px solid #ffc107; }
        .protocol-btn.liquid-feces { border-left: 6px solid #dc3545; }
        .protocol-btn.vomit { border-left: 6px solid #fd7e14; }
        .protocol-btn.pseudomonas { border-left: 6px solid #6f42c1; }

        .correction-selector {
            display: none;
            margin-bottom: 30px;
        }

        .correction-selector.active {
            display: block;
        }

        .form-container {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-container.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2a5298;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .results.active {
            display: block;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 6px solid #2a5298;
        }

        .result-card.alert {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff8f8 0%, #ffe8e8 100%);
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .result-content {
            line-height: 1.6;
        }

        .protocol-steps {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .protocol-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
        }

        .step-number {
            background: #2a5298;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .export-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .export-section.active {
            display: block;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .export-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 123, 255, 0.3);
        }

        .export-btn.pdf { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
        .export-btn.word { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); }
        .export-btn.text { background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .alert.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .alert.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .section-selector {
                grid-template-columns: 1fr;
            }
            
            .protocol-buttons {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .hidden {
            display: none !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2a5298;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }

        .critical {
            background: #f8d7da;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
            color: #721c24;
        }

        .report-section {
            display: none;
            margin-bottom: 30px;
        }

        .report-section.active {
            display: block;
        }

        .report-form-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .form-section h3 {
            color: #1e293b;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            margin-bottom: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }

        .checkbox-group input[type="text"],
        .checkbox-group input[type="number"] {
            width: auto;
            min-width: 80px;
            padding: 4px 8px;
            margin: 0 5px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .parameters-table {
            overflow-x: auto;
            margin: 15px 0;
        }

        .parameters-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .parameters-table th {
            background: #f1f5f9;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #334155;
            border-bottom: 2px solid #e2e8f0;
        }

        .parameters-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .parameters-table input {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 0.9rem;
        }

        .form-note {
            font-style: italic;
            color: #64748b;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .protocols-section {
            display: none;
            margin-bottom: 30px;
        }

        .protocols-section.active {
            display: block;
        }

        .protocols-container {
            display: grid;
            gap: 25px;
        }

        .protocol-info-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .protocol-header {
            padding: 20px;
            color: white;
            font-weight: bold;
        }

        .solid-feces-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .liquid-feces-header {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .vomit-header {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }

        .pseudomonas-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .surrounding-header {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        }

        .protocol-header h3 {
            margin: 0 0 10px 0;
            font-size: 1.4rem;
        }

        .protocol-specs {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .spec-item {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .protocol-steps-info {
            padding: 25px;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .step-item.small {
            margin-bottom: 8px;
            padding: 8px;
            background: #f1f5f9;
        }

        .step-number {
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .step-item.small .step-number {
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
        }

        .step-text {
            flex: 1;
            line-height: 1.5;
        }

        .protocol-branch {
            margin: 15px 0;
            padding: 15px;
            background: #fef3c7;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .branch-title {
            font-weight: bold;
            color: #92400e;
            margin-bottom: 10px;
        }

        .branch-content {
            color: #78350f;
            font-style: italic;
        }

        .branch-steps {
            margin-top: 10px;
        }

        .sub-steps {
            margin: 10px 0 10px 40px;
        }

        .sub-step {
            margin: 5px 0;
            color: #64748b;
            font-size: 0.95rem;
        }

        .normative-reference {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .normative-reference h3 {
            margin: 0 0 15px 0;
            color: #f1f5f9;
        }

        .normative-items {
            margin-bottom: 20px;
        }

        .normative-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }

        .important-note {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: #fef2f2;
        }

        @media (max-width: 768px) {
            .protocol-specs {
                justify-content: center;
            }
            
            .spec-item {
                font-size: 0.8rem;
                padding: 3px 8px;
            }
            
            .step-item {
                flex-direction: column;
                text-align: center;
            }
            
            .step-number {
                margin-right: 0;
                margin-bottom: 8px;
            }
        }

        /* Orders Section Styles */
        .orders-section {
            display: none;
            margin-bottom: 30px;
        }

        .orders-section.active {
            display: block;
        }

        .orders-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .orders-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            border-radius: 12px;
        }

        .orders-header h2 {
            margin: 0 0 8px 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .orders-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 0;
        }

        .date-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .date-section label {
            font-weight: 600;
            color: #1e293b;
        }

        .date-section input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .date-section input:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .stats-bar {
            display: none;
            background: #f0f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .stats-bar.show {
            display: grid;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: #06b6d4;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .products-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
        }

        .products-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            font-size: 0.95rem;
        }

        .products-table th:first-child {
            width: 50%;
        }

        .products-table th:nth-child(2),
        .products-table th:nth-child(3) {
            width: 25%;
            text-align: center;
        }

        .hotel-wave {
            background: linear-gradient(135deg, #06b6d4, #0891b2) !important;
            color: white !important;
        }

        .hotel-sky {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important;
            color: white !important;
        }

        .products-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
        }

        .products-table tr {
            transition: all 0.3s ease;
        }

        .products-table tr:hover {
            background-color: #f8fafc;
        }

        .products-table tr:nth-child(even) {
            background-color: #fdfdfd;
        }

        .product-name {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .quantity-input {
            width: 70px;
            padding: 8px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .quantity-input:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .quantity-input:not(:placeholder-shown) {
            background: #f0f9ff;
            border-color: #06b6d4;
        }

        .orders-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .orders-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            justify-content: center;
        }

        .orders-btn-primary {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .orders-btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        .orders-btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
        }

        .orders-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .orders-summary {
            background: #f8fafc;
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
            display: none;
            border: 1px solid #e2e8f0;
        }

        .orders-summary.show {
            display: block;
        }

        .orders-summary h3 {
            color: #1e293b;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .orders-summary-content {
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
            white-space: pre-line;
            background: white;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #1e293b;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #22c55e;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            font-weight: 500;
        }

        .toast.show {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            .orders-container {
                padding: 20px;
            }
            
            .stats-bar {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .products-table th,
            .products-table td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }
            
            .quantity-input {
                width: 55px;
                font-size: 0.85rem;
            }
            
            .orders-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .orders-btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> Protocolos de Actuaci贸n Piscinas</h1>
            <p>Calculadora Autom谩tica - Productos Pedrosa | Cumplimiento Normativo RD 742/2013</p>
        </div>

        <div class="main-content">
            <!-- Section Selector -->
            <div class="section-selector">
                <div class="section-card emergency" data-section="emergency">
                    <span class="card-icon"></span>
                    <div class="card-title">Protocolos de Emergencia</div>
                    <div class="card-description">Heces s贸lidas/l铆quidas, v贸mitos, Pseudomonas aeruginosa con c谩lculos autom谩ticos</div>
                </div>
                <div class="section-card correction" data-section="correction">
                    <span class="card-icon">锔</span>
                    <div class="card-title">Correcciones Diarias</div>
                    <div class="card-description">Ajuste de cloro libre y pH con dosis exactas de productos Pedrosa</div>
                </div>
                <div class="section-card report" data-section="report">
                    <span class="card-icon"></span>
                    <div class="card-title">Memorias de Actuaci贸n</div>
                    <div class="card-description">Generar documentos oficiales de registro de incidencias seg煤n normativa</div>
                </div>
                <div class="section-card protocols" data-section="protocols">
                    <span class="card-icon"></span>
                    <div class="card-title">Protocolos Informativos</div>
                    <div class="card-description">Consulta r谩pida de todos los protocolos de actuaci贸n oficiales</div>
                </div>
                <div class="section-card orders" data-section="orders">
                    <span class="card-icon"></span>
                    <div class="card-title">Pedidos Qu铆micos</div>
                    <div class="card-description">Sistema de gesti贸n de pedidos para Hoteles Wave & Sky</div>
                </div>
            </div>

            <!-- Emergency Protocol Selector -->
            <div class="protocol-selector" id="emergency-selector">
                <h2>Seleccionar Protocolo de Emergencia</h2>
                <div class="protocol-buttons">
                    <div class="protocol-btn solid-feces" data-protocol="solid-feces">
                        <h3> Heces S贸lidas</h3>
                        <p>2 ppm  30 minutos | pH &lt;7.5</p>
                    </div>
                    <div class="protocol-btn liquid-feces" data-protocol="liquid-feces">
                        <h3> Heces L铆quidas/Diarrea</h3>
                        <p>20 ppm  13 horas | Hipercloraci贸n</p>
                    </div>
                    <div class="protocol-btn vomit" data-protocol="vomit">
                        <h3>ぎ V贸mitos</h3>
                        <p>Evaluaci贸n + protocolo espec铆fico</p>
                    </div>
                    <div class="protocol-btn pseudomonas" data-protocol="pseudomonas">
                        <h3> Pseudomonas Aeruginosa</h3>
                        <p>12.5 ppm  24-48 horas</p>
                    </div>
                </div>
            </div>

            <!-- Correction Selector -->
            <div class="correction-selector" id="correction-selector">
                <h2>Seleccionar Tipo de Correcci贸n</h2>
                <div class="protocol-buttons">
                    <div class="protocol-btn" data-correction="chlorine">
                        <h3> Correcci贸n Cloro Libre</h3>
                        <p>Ajuste de concentraci贸n con productos Pedrosa</p>
                    </div>
                    <div class="protocol-btn" data-correction="ph-up">
                        <h3> Subir pH</h3>
                        <p>Carbonato s贸dico / Hidr贸xido s贸dico</p>
                    </div>
                    <div class="protocol-btn" data-correction="ph-down">
                        <h3> Bajar pH</h3>
                        <p>AQUA-PEDROSA / cido Clorh铆drico</p>
                    </div>
                </div>
            </div>

            <!-- Report Form Section -->
            <div class="report-section" id="report-section">
                <h2>Memoria de Actuaci贸n - Parte de Incidencias</h2>
                <div class="report-form-container">
                    <form id="incident-report-form">
                        <!-- Header Information -->
                        <div class="form-section">
                            <h3>Informaci贸n General</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="hotel-name">Hotel:</label>
                                    <input type="text" id="hotel-name" name="hotel-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="incident-date">Fecha:</label>
                                    <input type="date" id="incident-date" name="incident-date" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pool-affected">Piscina Afectada:</label>
                                    <input type="text" id="pool-affected" name="pool-affected" required>
                                </div>
                                <div class="form-group">
                                    <label for="detection-time">Hora Detecci贸n:</label>
                                    <input type="time" id="detection-time" name="detection-time" required>
                                </div>
                            </div>
                        </div>

                        <!-- Incident Type -->
                        <div class="form-section">
                            <h3>Tipo de Incidencia</h3>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="incident-type" value="heces-solidas"> Heces s贸lidas</label>
                                <label><input type="checkbox" name="incident-type" value="heces-liquidas"> Heces l铆quidas/diarrea</label>
                                <label><input type="checkbox" name="incident-type" value="vomitos"> V贸mitos</label>
                                <label><input type="checkbox" name="incident-type" value="pseudomonas"> Pseudomonas aeruginosa (an谩lisis)</label>
                                <label><input type="checkbox" name="incident-type" value="sangre"> Sangre</label>
                                <label><input type="checkbox" name="incident-type" value="zona-circundante"> Zona circundante</label>
                                <label><input type="checkbox" name="incident-type" value="otro"> Otro: <input type="text" id="other-incident" placeholder="Especificar..."></label>
                            </div>
                        </div>

                        <!-- Incident Description -->
                        <div class="form-section">
                            <h3>Descripci贸n del Incidente</h3>
                            <div class="form-group">
                                <textarea id="incident-description" name="incident-description" rows="4" placeholder="Descripci贸n detallada del incidente..."></textarea>
                            </div>
                        </div>

                        <!-- Actions Taken -->
                        <div class="form-section">
                            <h3>Actuaciones Realizadas</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pool-closure-time">Hora Cierre Piscina:</label>
                                    <input type="time" id="pool-closure-time" name="pool-closure-time">
                                </div>
                                <div class="form-group">
                                    <label for="responsible-person">Personal Responsable:</label>
                                    <input type="text" id="responsible-person" name="responsible-person">
                                </div>
                            </div>
                        </div>

                        <!-- Contamination Removal -->
                        <div class="form-section">
                            <h3>Retirada Contaminaci贸n</h3>
                            <div class="checkbox-group">
                                <label>Heces retiradas con:</label>
                                <label><input type="checkbox" name="removal-method" value="cesta"> Cesta</label>
                                <label><input type="checkbox" name="removal-method" value="red"> Red</label>
                                <label><input type="checkbox" name="removal-method" value="cubo"> Cubo</label>
                                <label><input type="checkbox" name="material-disinfected" value="yes"> Material desinfectado con lej铆a</label>
                            </div>
                            <div class="form-group">
                                <label for="removal-observations">Observaciones:</label>
                                <input type="text" id="removal-observations" name="removal-observations">
                            </div>
                        </div>

                        <!-- Water Parameters Table -->
                        <div class="form-section">
                            <h3>Par谩metros Agua</h3>
                            <div class="parameters-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Momento</th>
                                            <th>Cloro Libre (ppm)</th>
                                            <th>pH</th>
                                            <th>Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>Inicial</strong></td>
                                            <td><input type="number" step="0.1" name="chlorine-initial"></td>
                                            <td><input type="number" step="0.1" name="ph-initial"></td>
                                            <td><input type="text" name="obs-initial"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>1陋 Medici贸n</strong></td>
                                            <td><input type="number" step="0.1" name="chlorine-1"></td>
                                            <td><input type="number" step="0.1" name="ph-1"></td>
                                            <td><input type="text" name="obs-1"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>2陋 Medici贸n</strong></td>
                                            <td><input type="number" step="0.1" name="chlorine-2"></td>
                                            <td><input type="number" step="0.1" name="ph-2"></td>
                                            <td><input type="text" name="obs-2"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>3陋 Medici贸n</strong></td>
                                            <td><input type="number" step="0.1" name="chlorine-3"></td>
                                            <td><input type="number" step="0.1" name="ph-3"></td>
                                            <td><input type="text" name="obs-3"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Final</strong></td>
                                            <td><input type="number" step="0.1" name="chlorine-final"></td>
                                            <td><input type="number" step="0.1" name="ph-final"></td>
                                            <td><input type="text" name="obs-final"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Applied Treatment -->
                        <div class="form-section">
                            <h3>Tratamiento Aplicado</h3>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="treatment" value="hyperchlorination"> Hipercloraci贸n: 
                                    <input type="number" step="0.1" name="chlorination-ppm" placeholder="ppm"> ppm durante 
                                    <input type="number" name="chlorination-hours" placeholder="horas"> horas</label>
                                <label><input type="checkbox" name="treatment" value="neutralization"> Neutralizaci贸n cloro</label>
                                <label><input type="checkbox" name="treatment" value="vacuum"> Aspirado fondo/paredes</label>
                                <label><input type="checkbox" name="treatment" value="backwash"> Contralavado filtros</label>
                                <label><input type="checkbox" name="treatment" value="cleaning"> Limpieza skimmers/bordes</label>
                                <label><input type="checkbox" name="treatment" value="renewal"> Renovaci贸n agua superficial</label>
                                <label><input type="checkbox" name="treatment" value="other-treatment"> Otro: 
                                    <input type="text" name="other-treatment-desc" placeholder="Especificar..."></label>
                            </div>
                        </div>

                        <!-- Systems -->
                        <div class="form-section">
                            <h3>Sistemas</h3>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="systems" value="auto-disinfection-off"> Desinfecci贸n autom谩tica desconectada</label>
                                <label><input type="checkbox" name="systems" value="recirculation-on"> Recirculaci贸n funcionando</label>
                                <label><input type="checkbox" name="systems" value="filtration-on"> Filtraci贸n funcionando</label>
                                <label><input type="checkbox" name="systems" value="system-reconnected"> Sistema reconectado</label>
                            </div>
                        </div>

                        <!-- Times -->
                        <div class="form-section">
                            <h3>Tiempos</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="treatment-start">Inicio Tratamiento:</label>
                                    <input type="time" id="treatment-start" name="treatment-start">
                                </div>
                                <div class="form-group">
                                    <label for="treatment-end">Fin Tratamiento:</label>
                                    <input type="time" id="treatment-end" name="treatment-end">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="reopening-time">Hora Reapertura:</label>
                                    <input type="time" id="reopening-time" name="reopening-time">
                                </div>
                                <div class="form-group">
                                    <label for="total-closure">Tiempo Total Cierre:</label>
                                    <input type="text" id="total-closure" name="total-closure" placeholder="ej. 13 horas">
                                </div>
                            </div>
                        </div>

                        <!-- Laboratory Analysis -->
                        <div class="form-section">
                            <h3>An谩lisis Posterior</h3>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="analysis" value="sample-sent"> Muestra enviada a laboratorio</label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="send-date">Fecha env铆o:</label>
                                    <input type="date" id="send-date" name="send-date">
                                </div>
                                <div class="form-group">
                                    <label for="laboratory">Laboratorio:</label>
                                    <input type="text" id="laboratory" name="laboratory">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="result">Resultado:</label>
                                    <input type="text" id="result" name="result">
                                </div>
                                <div class="form-group">
                                    <label for="result-date">Fecha resultado:</label>
                                    <input type="date" id="result-date" name="result-date">
                                </div>
                            </div>
                        </div>

                        <!-- Communications -->
                        <div class="form-section">
                            <h3>Comunicaciones</h3>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="communications" value="hotel-management"> Direcci贸n hotel informada</label>
                                <label><input type="checkbox" name="communications" value="health-authority"> Autoridad sanitaria comunicada</label>
                                <label><input type="checkbox" name="communications" value="maintenance-company"> Empresa mantenimiento contactada</label>
                                <label><input type="checkbox" name="communications" value="guests-informed"> Hu茅spedes informados</label>
                            </div>
                        </div>

                        <!-- Preventive Measures -->
                        <div class="form-section">
                            <h3>Medidas Preventivas Adoptadas</h3>
                            <div class="form-group">
                                <textarea id="preventive-measures" name="preventive-measures" rows="3" placeholder="Descripci贸n de medidas preventivas..."></textarea>
                            </div>
                        </div>

                        <!-- Additional Observations -->
                        <div class="form-section">
                            <h3>Observaciones Adicionales</h3>
                            <div class="form-group">
                                <textarea id="additional-observations" name="additional-observations" rows="4" placeholder="Observaciones adicionales..."></textarea>
                            </div>
                        </div>

                        <!-- Signatures -->
                        <div class="form-section">
                            <h3>Firmas y Responsabilidades</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="technician-responsible">T茅cnico Responsable:</label>
                                    <input type="text" id="technician-responsible" name="technician-responsible">
                                </div>
                                <div class="form-group">
                                    <label for="signature-date">Fecha:</label>
                                    <input type="date" id="signature-date" name="signature-date">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="management-review">Revisado por Direcci贸n - Nombre:</label>
                                    <input type="text" id="management-review" name="management-review">
                                </div>
                                <div class="form-group">
                                    <label for="management-date">Fecha:</label>
                                    <input type="date" id="management-date" name="management-date">
                                </div>
                            </div>
                        </div>

                        <!-- Archive -->
                        <div class="form-section">
                            <h3>Archivo</h3>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="archive" value="pool-file"> Expediente piscina</label>
                                <label><input type="checkbox" name="archive" value="health-authority"> Autoridad sanitaria</label>
                                <label><input type="checkbox" name="archive" value="technical-direction"> Direcci贸n t茅cnica</label>
                            </div>
                            <p class="form-note">*Este documento debe conservarse m铆nimo 5 a帽os</p>
                        </div>

                        <!-- Export Buttons -->
                        <div class="export-section active">
                            <h3>Exportar Memoria</h3>
                            <div class="export-buttons">
                                <button type="button" class="export-btn pdf" onclick="exportToPDF()">
                                     Exportar PDF
                                </button>
                                <button type="button" class="export-btn text" onclick="exportToText()">
                                     Copiar Texto
                                </button>
                                <button type="button" class="export-btn word" onclick="exportToWord()">
                                     Descargar DOC
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Protocols Information Section -->
            <div class="protocols-section" id="protocols-section">
                <h2>Protocolos de Actuaci贸n Oficiales</h2>
                <div class="protocols-container">
                    
                    <!-- Heces S贸lidas Protocol -->
                    <div class="protocol-info-card">
                        <div class="protocol-header solid-feces-header">
                            <h3> Heces S贸lidas</h3>
                            <div class="protocol-specs">
                                <span class="spec-item">2 ppm  30 minutos</span>
                                <span class="spec-item">pH &lt; 7.5</span>
                            </div>
                        </div>
                        <div class="protocol-steps-info">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text"><strong>Cerrar piscina</strong> y desalojar ba帽istas</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">2</span>
                                <span class="step-text"><strong>Retirar heces</strong> con cesta/red (NUNCA aspirar)</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">3</span>
                                <span class="step-text"><strong>Desinfectar utensilios</strong> con lej铆a al 1%</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">4</span>
                                <span class="step-text"><strong>Ajustar agua</strong>: cloro libre 2 ppm + pH &lt;7,5</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">5</span>
                                <span class="step-text"><strong>Mantener 30 minutos</strong></span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">6</span>
                                <span class="step-text"><strong>Reapertura</strong> tras verificar niveles correctos</span>
                            </div>
                        </div>
                    </div>

                    <!-- Heces L铆quidas Protocol -->
                    <div class="protocol-info-card">
                        <div class="protocol-header liquid-feces-header">
                            <h3> Heces L铆quidas/Diarrea (HIPERCLORACIN)</h3>
                            <div class="protocol-specs">
                                <span class="spec-item">20 ppm  13 horas</span>
                                <span class="spec-item">pH &lt; 7.5</span>
                                <span class="spec-item">Cr铆tico</span>
                            </div>
                        </div>
                        <div class="protocol-steps-info">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text"><strong>Cerrar piscina</strong> y desalojar ba帽istas</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">2</span>
                                <span class="step-text"><strong>Retirar heces visibles</strong> con red/cubo (NO aspirar)</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">3</span>
                                <span class="step-text"><strong>Desconectar</strong> sistema desinfecci贸n autom谩tica</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">4</span>
                                <span class="step-text"><strong>Elevar cloro libre a 20 ppm</strong> + <strong>pH &lt;7,5</strong></span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">5</span>
                                <span class="step-text"><strong>Mantener 13 horas</strong> (o 40 ppm durante 7 horas)</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">6</span>
                                <span class="step-text"><strong>Controlar cada 2 horas</strong> niveles cloro/pH</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">7</span>
                                <span class="step-text"><strong>Aspirar fondo y paredes</strong>  agua al alcantarillado</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">8</span>
                                <span class="step-text"><strong>Contralavado filtros</strong>  agua al alcantarillado</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">9</span>
                                <span class="step-text"><strong>Neutralizar cloro</strong> a 0,5-2 ppm</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">10</span>
                                <span class="step-text"><strong>Reconectar</strong> sistema dosificaci贸n</span>
                            </div>
                        </div>
                    </div>

                    <!-- V贸mitos Protocol -->
                    <div class="protocol-info-card">
                        <div class="protocol-header vomit-header">
                            <h3>ぎ V贸mitos</h3>
                            <div class="protocol-specs">
                                <span class="spec-item">Evaluaci贸n + protocolo espec铆fico</span>
                            </div>
                        </div>
                        <div class="protocol-steps-info">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text"><strong>Evaluar si parecen infecciosos</strong></span>
                            </div>
                            <div class="protocol-branch">
                                <div class="branch-title">Si parecen infecciosos:</div>
                                <div class="branch-content">Aplicar protocolo heces l铆quidas completo</div>
                            </div>
                            <div class="protocol-branch">
                                <div class="branch-title">Si NO infecciosos:</div>
                                <div class="branch-steps">
                                    <div class="step-item small">
                                        <span class="step-number">2</span>
                                        <span class="step-text">Desalojar temporalmente</span>
                                    </div>
                                    <div class="step-item small">
                                        <span class="step-number">3</span>
                                        <span class="step-text">Retirar material visible</span>
                                    </div>
                                    <div class="step-item small">
                                        <span class="step-number">4</span>
                                        <span class="step-text">Cloro 2 ppm + pH &lt;7,5 durante 30 minutos</span>
                                    </div>
                                    <div class="step-item small">
                                        <span class="step-number">5</span>
                                        <span class="step-text">Reapertura</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pseudomonas Protocol -->
                    <div class="protocol-info-card">
                        <div class="protocol-header pseudomonas-header">
                            <h3> Pseudomonas Aeruginosa</h3>
                            <div class="protocol-specs">
                                <span class="spec-item">10-15 ppm  24-48 horas</span>
                                <span class="spec-item">Anti-biofilms</span>
                            </div>
                        </div>
                        <div class="protocol-steps-info">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text"><strong>CIERRE INMEDIATO</strong> piscina/SPA al detectar en an谩lisis</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">2</span>
                                <span class="step-text"><strong>LIMPIEZA MECNICA INTENSIVA:</strong></span>
                            </div>
                            <div class="sub-steps">
                                <div class="sub-step"> Vaciar skimmers completamente</div>
                                <div class="sub-step"> <strong>Rascar y frotar</strong> interior skimmers con cepillo duro</div>
                                <div class="sub-step"> <strong>Rascar bordes del vaso</strong> en toda la superficie</div>
                                <div class="sub-step"> <strong>Limpiar rebosaderos</strong> y canales perimetrales</div>
                                <div class="sub-step"> <strong>Cepillar paredes</strong> zona l铆nea de flotaci贸n</div>
                            </div>
                            <div class="step-item">
                                <span class="step-number">3</span>
                                <span class="step-text"><strong>RENOVACIN AGUA SUPERFICIAL:</strong></span>
                            </div>
                            <div class="sub-steps">
                                <div class="sub-step"> Eliminar 10-15 cm agua superficie (donde se concentra)</div>
                                <div class="sub-step"> Rellenar con agua nueva</div>
                            </div>
                            <div class="step-item">
                                <span class="step-number">4</span>
                                <span class="step-text"><strong>HIPERCLORACIN ESPECFICA:</strong></span>
                            </div>
                            <div class="sub-steps">
                                <div class="sub-step"> Elevar cloro libre a 10-15 ppm</div>
                                <div class="sub-step"> pH entre 7,0-7,5</div>
                                <div class="sub-step"> Mantener 24-48 horas</div>
                                <div class="sub-step"> Recirculaci贸n continua</div>
                            </div>
                            <div class="step-item">
                                <span class="step-number">5</span>
                                <span class="step-text"><strong>MANTENIMIENTO FILTROS:</strong></span>
                            </div>
                            <div class="sub-steps">
                                <div class="sub-step"> Contralavados cada 6-8 horas</div>
                                <div class="sub-step"> Sustituir arena/medio filtrante si necesario</div>
                            </div>
                            <div class="step-item">
                                <span class="step-number">6</span>
                                <span class="step-text"><strong>NUEVO ANLISIS:</strong></span>
                            </div>
                            <div class="sub-steps">
                                <div class="sub-step"> Tomar muestra tras tratamiento</div>
                                <div class="sub-step"> Esperar resultado negativo para reapertura</div>
                            </div>
                            <div class="step-item">
                                <span class="step-number">7</span>
                                <span class="step-text"><strong>Si persiste:</strong> Contratar empresa desinfecci贸n especializada</span>
                            </div>
                        </div>
                    </div>

                    <!-- Contaminaci贸n Zonas Circundantes -->
                    <div class="protocol-info-card">
                        <div class="protocol-header surrounding-header">
                            <h3> Contaminaci贸n en Zonas Circundantes</h3>
                            <div class="protocol-specs">
                                <span class="spec-item">Protocolo r谩pido</span>
                                <span class="spec-item">10 minutos</span>
                            </div>
                        </div>
                        <div class="protocol-steps-info">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text"><strong>Aislar zona</strong> con se帽alizaci贸n</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">2</span>
                                <span class="step-text"><strong>Retirar contaminante</strong>  bolsa cerrada</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">3</span>
                                <span class="step-text"><strong>Limpiar con lej铆a</strong> (usar guantes)</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">4</span>
                                <span class="step-text"><strong>Aclarar</strong> con agua (evitar caiga al vaso)</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">5</span>
                                <span class="step-text"><strong>Desinfectar utensilios</strong> y lavarse manos</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">6</span>
                                <span class="step-text"><strong>Esperar 10 minutos</strong>  permitir acceso</span>
                            </div>
                        </div>
                    </div>

                    <!-- Normativa Reference -->
                    <div class="normative-reference">
                        <h3> Marco Normativo</h3>
                        <div class="normative-items">
                            <div class="normative-item">
                                <strong>Real Decreto 742/2013:</strong> Criterios t茅cnico-sanitarios piscinas
                            </div>
                            <div class="normative-item">
                                <strong>Decreto 99/2024:</strong> Nuevos criterios piscinas comunitarias
                            </div>
                            <div class="normative-item">
                                <strong>Real Decreto 3/2023:</strong> Criterios agua de consumo
                            </div>
                        </div>
                        <div class="important-note">
                            <strong>锔 Importante:</strong> Estos protocolos deben aplicarse seg煤n la normativa vigente. 
                            En caso de duda, consultar con las autoridades sanitarias competentes.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div class="orders-section" id="orders-section">
                <div class="orders-container">
                    <div class="orders-header">
                        <h2> Pedidos Qu铆micos</h2>
                        <p class="orders-subtitle">Sistema de Gesti贸n de Pedidos - Hoteles Wave & Sky</p>
                    </div>

                    <div class="date-section">
                        <label for="orderDate"> Fecha del pedido:</label>
                        <input type="date" id="orderDate">
                    </div>

                    <div class="stats-bar" id="statsBar">
                        <div class="stat-item">
                            <span class="stat-number" id="waveCount">0</span>
                            <span class="stat-label">Productos Wave</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="skyCount">0</span>
                            <span class="stat-label">Productos Sky</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="totalCount">0</span>
                            <span class="stat-label">Total Productos</span>
                        </div>
                    </div>

                    <div class="products-section">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>И Producto</th>
                                    <th class="hotel-wave"> Hotel Wave</th>
                                    <th class="hotel-sky">锔 Hotel Sky</th>
                                </tr>
                            </thead>
                            <tbody id="productsTable">
                                <!-- Products will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="orders-actions">
                        <button class="orders-btn orders-btn-primary" onclick="generateOrderSummary()">
                             Generar Resumen
                        </button>
                        <button class="orders-btn orders-btn-success" onclick="shareOrderWhatsApp()">
                             Compartir WhatsApp
                        </button>
                        <button class="orders-btn orders-btn-secondary" onclick="clearOrderForm()">
                            锔 Limpiar Todo
                        </button>
                    </div>

                    <div class="orders-summary" id="ordersSummary">
                        <h3> Resumen del Pedido</h3>
                        <div class="orders-summary-content" id="ordersSummaryContent"></div>
                    </div>
                </div>
            </div>

            <!-- Forms Container -->
            <div class="form-container" id="calculation-form">
                <h2 id="form-title">Formulario de C谩lculo</h2>
                <form id="calculator-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="volume">Volumen de la piscina (m鲁)</label>
                            <input type="number" id="volume" name="volume" min="0.01" step="0.01" required>
                        </div>
                        <div class="form-group" id="product-group">
                            <label for="product">Producto Pedrosa</label>
                            <select id="product" name="product" required>
                                <option value="">Seleccionar producto...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row" id="current-values">
                        <div class="form-group" id="current-chlorine-group">
                            <label for="current-chlorine">Cloro libre actual (ppm)</label>
                            <input type="number" id="current-chlorine" name="current-chlorine" min="0" step="0.1">
                        </div>
                        <div class="form-group" id="target-chlorine-group">
                            <label for="target-chlorine">Cloro libre deseado (ppm)</label>
                            <input type="number" id="target-chlorine" name="target-chlorine" min="0" step="0.1">
                        </div>
                        <div class="form-group" id="current-ph-group">
                            <label for="current-ph">pH actual</label>
                            <input type="number" id="current-ph" name="current-ph" min="6.0" max="9.0" step="0.1">
                        </div>
                        <div class="form-group" id="target-ph-group">
                            <label for="target-ph">pH deseado</label>
                            <input type="number" id="target-ph" name="target-ph" min="6.0" max="9.0" step="0.1">
                        </div>
                    </div>

                    <button type="submit" class="calculate-btn">
                        <span>М Calcular Dosis y Protocolo</span>
                        <span class="loading hidden"></span>
                    </button>
                </form>
            </div>

            <!-- Results Section -->
            <div class="results" id="results-section">
                <div id="calculation-results"></div>
                <div id="protocol-steps"></div>
            </div>

            <!-- Export Section -->
            <div class="export-section" id="export-section">
                <h2> Generar Memoria de Actuaci贸n</h2>
                <p>Exportar protocolo y c谩lculos realizados en diferentes formatos:</p>
                <div class="export-buttons">
                    <button class="export-btn pdf" onclick="exportToPDF()">
                         Exportar PDF
                    </button>
                    <button class="export-btn word" onclick="exportToWord()">
                         Exportar Word
                    </button>
                    <button class="export-btn text" onclick="copyToClipboard()">
                         Copiar Texto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Product Database
        const PRODUCTS = {
            chlorine: {
                'AQUACLOR 180 PEDROSA': { concentration: 12, type: 'liquid', density: 1.12 },
                'CLA LEJA PEDROSA': { concentration: 5, type: 'liquid', density: 1.05 },
                'Hipoclorito c谩lcico 70%': { concentration: 70, type: 'solid', density: 1 },
                'Hipoclorito c谩lcico 65%': { concentration: 65, type: 'solid', density: 1 }
            },
            phUp: {
                'Carbonato s贸dico': { type: 'solid', factor: 0.015 },
                'Hidr贸xido s贸dico': { type: 'solid', factor: 0.012 }
            },
            phDown: {
                'AQUA-PEDROSA': { type: 'liquid', factor: 0.01, concentration: 38 },
                'cido Clorh铆drico 33%': { type: 'liquid', factor: 0.008, concentration: 33 },
                'Bisulfato s贸dico': { type: 'solid', factor: 0.018 }
            }
        };

        // Current calculation data
        let currentCalculation = null;
        let currentProtocol = null;
        let currentSection = null;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
        });

        function initializeEventListeners() {
            // Section selection
            document.querySelectorAll('.section-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectSection(this.dataset.section);
                });
            });

            // Protocol selection
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.dataset.protocol) {
                        selectProtocol(this.dataset.protocol);
                    } else if (this.dataset.correction) {
                        selectCorrection(this.dataset.correction);
                    }
                });
            });

            // Form submission
            document.getElementById('calculator-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateDose();
            });

            // Real-time validation
            document.getElementById('volume').addEventListener('input', validateVolume);
            document.getElementById('current-ph').addEventListener('input', validatepH);
            document.getElementById('target-ph').addEventListener('input', validatepH);
        }

        function selectSection(section) {
            currentSection = section;
            
            // Update active section card
            document.querySelectorAll('.section-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Show appropriate selector
            document.querySelectorAll('.protocol-selector, .correction-selector, .report-section, .protocols-section, .orders-section').forEach(sel => {
                sel.classList.remove('active');
            });
            
            if (section === 'emergency') {
                document.getElementById('emergency-selector').classList.add('active');
            } else if (section === 'correction') {
                document.getElementById('correction-selector').classList.add('active');
            } else if (section === 'report') {
                document.getElementById('report-section').classList.add('active');
                // Set current date as default
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('incident-date').value = today;
                document.getElementById('signature-date').value = today;
                document.getElementById('management-date').value = today;
            } else if (section === 'protocols') {
                document.getElementById('protocols-section').classList.add('active');
            } else if (section === 'orders') {
                document.getElementById('orders-section').classList.add('active');
                initializeOrders();
            }

            // Hide form and results for calculator sections
            if (section !== 'report') {
                hideFormAndResults();
            }
        }

        function selectProtocol(protocol) {
            currentProtocol = protocol;
            
            // Update active protocol button
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-protocol="${protocol}"]`).classList.add('active');

            setupEmergencyForm(protocol);
            showForm();
        }

        function selectCorrection(correction) {
            currentProtocol = correction;
            
            // Update active correction button
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-correction="${correction}"]`).classList.add('active');

            setupCorrectionForm(correction);
            showForm();
        }

        function setupEmergencyForm(protocol) {
            const formTitle = document.getElementById('form-title');
            const productSelect = document.getElementById('product');
            
            // Set form title
            const titles = {
                'solid-feces': ' Protocolo Heces S贸lidas - C谩lculo de Dosis',
                'liquid-feces': ' Protocolo Heces L铆quidas/Diarrea - Hipercloraci贸n',
                'vomit': 'ぎ Protocolo V贸mitos - Evaluaci贸n y Tratamiento',
                'pseudomonas': ' Protocolo Pseudomonas Aeruginosa - Tratamiento Espec铆fico'
            };
            formTitle.textContent = titles[protocol];

            // Setup product options
            productSelect.innerHTML = '<option value="">Seleccionar producto...</option>';
            Object.keys(PRODUCTS.chlorine).forEach(product => {
                const option = document.createElement('option');
                option.value = product;
                option.textContent = product;
                productSelect.appendChild(option);
            });

            // Show/hide form fields
            document.getElementById('current-chlorine-group').style.display = 'none';
            document.getElementById('target-chlorine-group').style.display = 'none';
            document.getElementById('current-ph-group').style.display = 'block';
            document.getElementById('target-ph-group').style.display = 'none';
        }

        function setupCorrectionForm(correction) {
            const formTitle = document.getElementById('form-title');
            const productSelect = document.getElementById('product');
            
            // Set form title
            const titles = {
                'chlorine': ' Correcci贸n Cloro Libre - C谩lculo de Dosis',
                'ph-up': ' Correcci贸n pH - Subir pH',
                'ph-down': ' Correcci贸n pH - Bajar pH'
            };
            formTitle.textContent = titles[correction];

            // Setup product options
            productSelect.innerHTML = '<option value="">Seleccionar producto...</option>';
            
            let products = {};
            if (correction === 'chlorine') {
                products = PRODUCTS.chlorine;
            } else if (correction === 'ph-up') {
                products = PRODUCTS.phUp;
            } else if (correction === 'ph-down') {
                products = PRODUCTS.phDown;
            }

            Object.keys(products).forEach(product => {
                const option = document.createElement('option');
                option.value = product;
                option.textContent = product;
                productSelect.appendChild(option);
            });

            // Show/hide form fields based on correction type
            if (correction === 'chlorine') {
                document.getElementById('current-chlorine-group').style.display = 'block';
                document.getElementById('target-chlorine-group').style.display = 'block';
                document.getElementById('current-ph-group').style.display = 'block';
                document.getElementById('target-ph-group').style.display = 'none';
            } else {
                document.getElementById('current-chlorine-group').style.display = 'none';
                document.getElementById('target-chlorine-group').style.display = 'none';
                document.getElementById('current-ph-group').style.display = 'block';
                document.getElementById('target-ph-group').style.display = 'block';
            }
        }

        function showForm() {
            document.getElementById('calculation-form').classList.add('active');
            document.getElementById('results-section').classList.remove('active');
            document.getElementById('export-section').classList.remove('active');
            
            // Scroll to form
            document.getElementById('calculation-form').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function hideFormAndResults() {
            document.getElementById('calculation-form').classList.remove('active');
            document.getElementById('results-section').classList.remove('active');
            document.getElementById('export-section').classList.remove('active');
        }

        function validateVolume() {
            const volume = parseFloat(document.getElementById('volume').value);
            if (volume < 0.01) {
                document.getElementById('volume').value = 0.01;
            }
        }

        function validatepH() {
            const inputs = ['current-ph', 'target-ph'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input.value) {
                    const pH = parseFloat(input.value);
                    if (pH < 6.0) input.value = 6.0;
                    if (pH > 9.0) input.value = 9.0;
                }
            });
        }

        function calculateDose() {
            // Show loading
            const loadingSpinner = document.querySelector('.loading');
            const buttonText = document.querySelector('.calculate-btn span:first-child');
            loadingSpinner.classList.remove('hidden');
            buttonText.textContent = 'Calculando...';

            // Get form data
            const formData = new FormData(document.getElementById('calculator-form'));
            const data = Object.fromEntries(formData.entries());

            // Validate required fields
            if (!data.volume || !data.product) {
                showAlert('Por favor, completa todos los campos obligatorios.', 'error');
                resetButton();
                return;
            }

            try {
                // Perform calculation based on current protocol
                if (currentSection === 'emergency') {
                    currentCalculation = calculateEmergencyProtocol(data);
                } else if (currentSection === 'correction') {
                    currentCalculation = calculateCorrection(data);
                }

                // Display results
                displayResults(currentCalculation);
                
                // Show export section
                document.getElementById('export-section').classList.add('active');

            } catch (error) {
                showAlert(`Error en el c谩lculo: ${error.message}`, 'error');
            }

            resetButton();
        }

        function calculateEmergencyProtocol(data) {
            const volume = parseFloat(data.volume);
            const product = data.product;
            const currentpH = parseFloat(data['current-ph']) || 7.0;
            
            const productData = PRODUCTS.chlorine[product];
            if (!productData) {
                throw new Error('Producto no encontrado');
            }

            let targetPpm = 0;
            let treatmentTime = '';
            let protocolSteps = [];
            let alerts = [];

            // Check pH condition
            if (currentpH >= 7.5) {
                alerts.push({
                    type: 'critical',
                    message: `锔 ATENCIN: pH actual (${currentpH}) debe ser <7.5 para m谩xima eficacia del cloro. Ajustar pH antes del tratamiento.`
                });
            }

            // Set target concentration based on protocol
            switch (currentProtocol) {
                case 'solid-feces':
                    targetPpm = 2;
                    treatmentTime = '30 minutos';
                    protocolSteps = getSolidFecesSteps();
                    break;
                case 'liquid-feces':
                    targetPpm = 20;
                    treatmentTime = '13 horas (o 40 ppm  7 horas)';
                    protocolSteps = getLiquidFecesSteps();
                    break;
                case 'vomit':
                    targetPpm = 2;
                    treatmentTime = '30 minutos (si no infeccioso)';
                    protocolSteps = getVomitSteps();
                    break;
                case 'pseudomonas':
                    targetPpm = 12.5;
                    treatmentTime = '24-48 horas';
                    protocolSteps = getPseudomonasSteps();
                    break;
            }

            // Calculate required amount
            const chlorineNeeded = (targetPpm * volume) / 1000; // kg of pure chlorine
            const productNeeded = chlorineNeeded / (productData.concentration / 100);
            
            let amount, unit, dosePerM3;
            if (productData.type === 'liquid') {
                amount = productNeeded / productData.density; // Convert to liters
                unit = 'L';
                dosePerM3 = amount / volume;
            } else {
                amount = productNeeded;
                unit = 'kg';
                dosePerM3 = amount / volume;
            }

            return {
                protocol: currentProtocol,
                volume: volume,
                product: product,
                targetPpm: targetPpm,
                amount: Math.round(amount * 100) / 100,
                unit: unit,
                dosePerM3: Math.round(dosePerM3 * 1000) / 1000,
                chlorineActive: Math.round(chlorineNeeded * 1000) / 1000,
                treatmentTime: treatmentTime,
                steps: protocolSteps,
                alerts: alerts,
                currentpH: currentpH
            };
        }

        function calculateCorrection(data) {
            const volume = parseFloat(data.volume);
            const product = data.product;
            const currentpH = parseFloat(data['current-ph']) || 7.0;
            
            let amount, unit, dosePerM3, targetValue, currentValue, increment;
            let steps = [];
            let alerts = [];

            if (currentProtocol === 'chlorine') {
                currentValue = parseFloat(data['current-chlorine']) || 0;
                targetValue = parseFloat(data['target-chlorine']) || 0;
                
                if (targetValue <= currentValue) {
                    throw new Error('El valor deseado debe ser mayor que el actual');
                }

                increment = targetValue - currentValue;
                const productData = PRODUCTS.chlorine[product];
                const chlorineNeeded = (increment * volume) / 1000;
                const productNeeded = chlorineNeeded / (productData.concentration / 100);
                
                if (productData.type === 'liquid') {
                    amount = productNeeded / productData.density;
                    unit = 'L';
                } else {
                    amount = productNeeded;
                    unit = 'kg';
                }
                
                dosePerM3 = amount / volume;
                steps = getChlorineSteps();
                
                if (currentpH >= 7.5) {
                    alerts.push({
                        type: 'warning',
                        message: ` RECOMENDACIN: pH actual (${currentpH}) es alto. Para mejor eficacia, considera ajustar pH a <7.5`
                    });
                }

            } else if (currentProtocol === 'ph-up') {
                currentValue = currentpH;
                targetValue = parseFloat(data['target-ph']) || 7.0;
                
                if (targetValue <= currentValue) {
                    throw new Error('El pH deseado debe ser mayor que el actual');
                }

                increment = targetValue - currentValue;
                const productData = PRODUCTS.phUp[product];
                amount = (increment * 10) * productData.factor * volume;
                unit = 'kg';
                dosePerM3 = amount / volume;
                steps = getpHUpSteps();

            } else if (currentProtocol === 'ph-down') {
                currentValue = currentpH;
                targetValue = parseFloat(data['target-ph']) || 7.0;
                
                if (targetValue >= currentValue) {
                    throw new Error('El pH deseado debe ser menor que el actual');
                }

                increment = currentValue - targetValue;
                const productData = PRODUCTS.phDown[product];
                
                if (productData.type === 'liquid') {
                    amount = (increment * 10) * productData.factor * volume;
                    unit = 'L';
                } else {
                    amount = (increment * 10) * productData.factor * volume;
                    unit = 'kg';
                }
                
                dosePerM3 = amount / volume;
                steps = getpHDownSteps();
            }

            return {
                protocol: currentProtocol,
                volume: volume,
                product: product,
                amount: Math.round(amount * 100) / 100,
                unit: unit,
                dosePerM3: Math.round(dosePerM3 * 1000) / 1000,
                currentValue: currentValue,
                targetValue: targetValue,
                increment: Math.round(increment * 100) / 100,
                treatmentTime: '2-4 horas',
                steps: steps,
                alerts: alerts,
                currentpH: currentpH
            };
        }

        function displayResults(calculation) {
            const resultsContainer = document.getElementById('calculation-results');
            const protocolContainer = document.getElementById('protocol-steps');
            
            // Display alerts first
            let alertsHtml = '';
            calculation.alerts.forEach(alert => {
                alertsHtml += `<div class="alert ${alert.type === 'critical' ? 'critical' : ''}">${alert.message}</div>`;
            });

            // Display calculation results
            let resultsHtml = `
                ${alertsHtml}
                <div class="result-card">
                    <div class="result-title"> Resultados del C谩lculo</div>
                    <div class="result-content">
                        <p><strong>Volumen de la piscina:</strong> ${calculation.volume} m鲁</p>
                        <p><strong>Producto seleccionado:</strong> ${calculation.product}</p>
                        <p><strong>Cantidad necesaria:</strong> ${calculation.amount} ${calculation.unit}</p>
                        <p><strong>Dosis por m鲁:</strong> ${calculation.dosePerM3} ${calculation.unit}/m鲁</p>
            `;

            if (currentSection === 'emergency') {
                resultsHtml += `
                        <p><strong>Concentraci贸n objetivo:</strong> ${calculation.targetPpm} ppm</p>
                        <p><strong>Cloro activo:</strong> ${calculation.chlorineActive} kg</p>
                `;
            } else {
                resultsHtml += `
                        <p><strong>Valor actual:</strong> ${calculation.currentValue} ${currentProtocol === 'chlorine' ? 'ppm' : 'pH'}</p>
                        <p><strong>Valor objetivo:</strong> ${calculation.targetValue} ${currentProtocol === 'chlorine' ? 'ppm' : 'pH'}</p>
                        <p><strong>Incremento:</strong> +${calculation.increment} ${currentProtocol === 'chlorine' ? 'ppm' : 'unidades pH'}</p>
                `;
            }

            resultsHtml += `
                        <p><strong>Tiempo de tratamiento:</strong> ${calculation.treatmentTime}</p>
                        <div class="highlight">
                            <strong> Equivalencia pr谩ctica:</strong> ${Math.round(calculation.amount * 1000)} mL / ${Math.ceil(calculation.amount * 10) / 10} ${calculation.unit}
                        </div>
                    </div>
                </div>
            `;

            resultsContainer.innerHTML = resultsHtml;

            // Display protocol steps
            let stepsHtml = `
                <div class="result-card">
                    <div class="result-title"> Protocolo de Actuaci贸n Paso a Paso</div>
                    <div class="protocol-steps">
            `;

            calculation.steps.forEach((step, index) => {
                stepsHtml += `
                    <div class="protocol-step">
                        <div class="step-number">${index + 1}</div>
                        <div class="step-content">${step}</div>
                    </div>
                `;
            });

            stepsHtml += `
                    </div>
                </div>
            `;

            protocolContainer.innerHTML = stepsHtml;

            // Show results
            document.getElementById('results-section').classList.add('active');
            
            // Scroll to results
            document.getElementById('results-section').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function resetButton() {
            const loadingSpinner = document.querySelector('.loading');
            const buttonText = document.querySelector('.calculate-btn span:first-child');
            loadingSpinner.classList.add('hidden');
            buttonText.textContent = 'М Calcular Dosis y Protocolo';
        }

        function showAlert(message, type = 'warning') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.textContent = message;
            
            const form = document.getElementById('calculation-form');
            form.insertBefore(alertDiv, form.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Protocol Steps Functions
        function getSolidFecesSteps() {
            return [
                " <strong>Cerrar piscina</strong> inmediatamente y desalojar a todos los ba帽istas",
                " <strong>Retirar heces</strong> con cesta/red (NUNCA aspirar directamente)",
                "Ы <strong>Desinfectar utensilios</strong> utilizados con lej铆a al 1%",
                "锔 <strong>Ajustar par谩metros</strong>: Aplicar dosis calculada para alcanzar 2 ppm de cloro libre",
                " <strong>Mantener tratamiento</strong> durante 30 minutos con recirculaci贸n activa",
                " <strong>Verificar y reabrir</strong>: Confirmar niveles correctos antes de permitir el acceso"
            ];
        }

        function getLiquidFecesSteps() {
            return [
                " <strong>Cerrar piscina</strong> inmediatamente y desalojar a todos los ba帽istas",
                " <strong>Retirar heces visibles</strong> con red/cubo (NO aspirar)",
                "锔 <strong>Desconectar sistema</strong> de desinfecci贸n autom谩tica",
                "锔 <strong>Elevar cloro libre a 20 ppm</strong>: Aplicar dosis calculada + ajustar pH <7.5",
                " <strong>Mantener hipercloraci贸n</strong> durante 13 horas (o 40 ppm  7 horas)",
                " <strong>Controlar cada 2 horas</strong> los niveles de cloro y pH",
                "Ч <strong>Aspirar fondo y paredes</strong>  dirigir agua directamente al alcantarillado",
                " <strong>Contralavado de filtros</strong>  agua al alcantarillado",
                "锔 <strong>Neutralizar cloro</strong> gradualmente hasta 0.5-2 ppm",
                " <strong>Reconectar sistema</strong> de dosificaci贸n autom谩tica"
            ];
        }

        function getVomitSteps() {
            return [
                "ぎ <strong>Evaluar naturaleza</strong>: Determinar si los v贸mitos parecen infecciosos",
                "锔 <strong>Si parecen infecciosos</strong>: Aplicar protocolo completo de heces l铆quidas",
                " <strong>Si NO infecciosos</strong>: Continuar con protocolo reducido",
                " <strong>Desalojar temporalmente</strong> el 谩rea afectada",
                " <strong>Retirar material visible</strong> con utensilios desechables",
                "锔 <strong>Aplicar tratamiento</strong>: 2 ppm cloro libre + pH <7.5 durante 30 minutos"
            ];
        }

        function getPseudomonasSteps() {
            return [
                " <strong>CIERRE INMEDIATO</strong> de piscina/SPA al detectar en an谩lisis",
                "Ы <strong>Vaciar skimmers</strong> completamente y raspar interior con cepillo duro",
                " <strong>Raspar bordes del vaso</strong> en toda la superficie perimetral",
                "Ч <strong>Limpiar rebosaderos</strong> y canales perimetrales completamente",
                " <strong>Cepillar paredes</strong> especialmente en zona de l铆nea de flotaci贸n",
                " <strong>Renovar agua superficial</strong>: Eliminar 10-15 cm de superficie",
                " <strong>Rellenar con agua nueva</strong> hasta nivel normal",
                "锔 <strong>Hipercloraci贸n espec铆fica</strong>: Aplicar dosis para 12.5 ppm cloro libre",
                " <strong>Ajustar pH</strong> entre 7.0-7.5 para m谩xima eficacia",
                " <strong>Mantener 24-48 horas</strong> con recirculaci贸n continua",
                " <strong>Contralavados cada 6-8 horas</strong> durante el tratamiento",
                " <strong>Tomar nueva muestra</strong> para an谩lisis tras finalizar tratamiento",
                " <strong>Esperar resultado negativo</strong> antes de reapertura"
            ];
        }

        function getChlorineSteps() {
            return [
                " <strong>Medir par谩metros actuales</strong>: Confirmar cloro libre y pH",
                "锔 <strong>Aplicar dosis calculada</strong> distribuyendo uniformemente por la piscina",
                " <strong>Activar recirculaci贸n</strong> para homogeneizar el tratamiento",
                " <strong>Esperar 15-30 minutos</strong> para completa disoluci贸n y mezcla",
                " <strong>Verificar concentraci贸n final</strong>: Confirmar nivel objetivo alcanzado"
            ];
        }

        function getpHUpSteps() {
            return [
                " <strong>Medir pH actual</strong>: Confirmar valor de partida",
                "锔 <strong>Aplicar dosis calculada</strong> distribuyendo el producto s贸lido uniformemente",
                " <strong>Activar recirculaci贸n</strong> para acelerar disoluci贸n",
                " <strong>Esperar 2-4 horas</strong> para estabilizaci贸n completa",
                " <strong>Verificar pH final</strong>: Confirmar valor objetivo alcanzado"
            ];
        }

        function getpHDownSteps() {
            return [
                " <strong>Medir pH actual</strong>: Confirmar valor de partida",
                "锔 <strong>Aplicar dosis calculada</strong> con precauci贸n y distribuci贸n uniforme",
                " <strong>Activar recirculaci贸n</strong> para homogeneizaci贸n",
                " <strong>Esperar 2-4 horas</strong> para estabilizaci贸n completa",
                " <strong>Verificar pH final</strong>: Confirmar valor objetivo alcanzado"
            ];
        }

        // Export Functions
        function exportToPDF() {
            if (!currentCalculation) {
                showAlert('No hay c谩lculos para exportar', 'error');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('MEMORIA DE ACTUACIN - PISCINA', 20, 20);
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 20, 30);
            doc.text(`Hora: ${new Date().toLocaleTimeString('es-ES')}`, 120, 30);
            
            // Protocol info
            let yPos = 45;
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            
            const protocolNames = {
                'solid-feces': 'Heces S贸lidas',
                'liquid-feces': 'Heces L铆quidas/Diarrea - Hipercloraci贸n',
                'vomit': 'V贸mitos',
                'pseudomonas': 'Pseudomonas Aeruginosa',
                'chlorine': 'Correcci贸n Cloro Libre',
                'ph-up': 'Correcci贸n pH - Subir',
                'ph-down': 'Correcci贸n pH - Bajar'
            };
            
            doc.text(`PROTOCOLO: ${protocolNames[currentCalculation.protocol]}`, 20, yPos);
            yPos += 15;
            
            // Calculation details
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('DATOS DEL CLCULO:', 20, yPos);
            yPos += 10;
            
            doc.setFont(undefined, 'normal');
            doc.text(`Volumen de la piscina: ${currentCalculation.volume} m鲁`, 20, yPos);
            yPos += 7;
            doc.text(`Producto utilizado: ${currentCalculation.product}`, 20, yPos);
            yPos += 7;
            doc.text(`Cantidad necesaria: ${currentCalculation.amount} ${currentCalculation.unit}`, 20, yPos);
            yPos += 7;
            doc.text(`Dosis por m鲁: ${currentCalculation.dosePerM3} ${currentCalculation.unit}/m鲁`, 20, yPos);
            yPos += 7;
            doc.text(`Tiempo de tratamiento: ${currentCalculation.treatmentTime}`, 20, yPos);
            yPos += 15;
            
            // Protocol steps
            doc.setFont(undefined, 'bold');
            doc.text('PROTOCOLO DE ACTUACIN:', 20, yPos);
            yPos += 10;
            
            doc.setFont(undefined, 'normal');
            currentCalculation.steps.forEach((step, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                const cleanStep = step.replace(/<[^>]*>/g, '');
                const lines = doc.splitTextToSize(`${index + 1}. ${cleanStep}`, 170);
                doc.text(lines, 20, yPos);
                yPos += lines.length * 7;
            });
            
            // Footer
            if (yPos > 250) {
                doc.addPage();
                yPos = 20;
            }
            
            yPos += 20;
            doc.setFont(undefined, 'bold');
            doc.text('TCNICO RESPONSABLE:', 20, yPos);
            yPos += 15;
            doc.text('Nombre: ________________________', 20, yPos);
            yPos += 10;
            doc.text('Firma: ________________________', 20, yPos);
            doc.text('Fecha: ________________________', 120, yPos);
            
            // Save
            doc.save(`memoria-actuacion-${currentCalculation.protocol}-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function exportToWord() {
            if (!currentCalculation) {
                showAlert('No hay c谩lculos para exportar', 'error');
                return;
            }

            const protocolNames = {
                'solid-feces': 'Heces S贸lidas',
                'liquid-feces': 'Heces L铆quidas/Diarrea - Hipercloraci贸n',
                'vomit': 'V贸mitos',
                'pseudomonas': 'Pseudomonas Aeruginosa',
                'chlorine': 'Correcci贸n Cloro Libre',
                'ph-up': 'Correcci贸n pH - Subir',
                'ph-down': 'Correcci贸n pH - Bajar'
            };

            // Create protocol steps as paragraphs
            const stepParagraphs = currentCalculation.steps.map((step, index) => {
                return new docx.Paragraph({
                    text: `${index + 1}. ${step.replace(/<[^>]*>/g, '')}`,
                    spacing: { after: 200 }
                });
            });

            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            text: "MEMORIA DE ACTUACIN - PISCINA",
                            heading: docx.HeadingLevel.TITLE,
                            alignment: docx.AlignmentType.CENTER,
                            spacing: { after: 400 }
                        }),
                        new docx.Paragraph({
                            text: `Fecha: ${new Date().toLocaleDateString('es-ES')}`,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `Hora: ${new Date().toLocaleTimeString('es-ES')}`,
                            spacing: { after: 400 }
                        }),
                        new docx.Paragraph({
                            text: `PROTOCOLO: ${protocolNames[currentCalculation.protocol]}`,
                            heading: docx.HeadingLevel.HEADING_1,
                            spacing: { after: 300 }
                        }),
                        new docx.Paragraph({
                            text: "DATOS DEL CLCULO:",
                            heading: docx.HeadingLevel.HEADING_2,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `Volumen de la piscina: ${currentCalculation.volume} m鲁`,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `Producto utilizado: ${currentCalculation.product}`,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `Cantidad necesaria: ${currentCalculation.amount} ${currentCalculation.unit}`,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `Dosis por m鲁: ${currentCalculation.dosePerM3} ${currentCalculation.unit}/m鲁`,
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            text: `Tiempo de tratamiento: ${currentCalculation.treatmentTime}`,
                            spacing: { after: 400 }
                        }),
                        new docx.Paragraph({
                            text: "PROTOCOLO DE ACTUACIN:",
                            heading: docx.HeadingLevel.HEADING_2,
                            spacing: { after: 200 }
                        }),
                        ...stepParagraphs,
                        new docx.Paragraph({
                            text: "TCNICO RESPONSABLE:",
                            heading: docx.HeadingLevel.HEADING_2,
                            spacing: { before: 600, after: 300 }
                        }),
                        new docx.Paragraph({
                            text: "Nombre: ________________________",
                            spacing: { after: 300 }
                        }),
                        new docx.Paragraph({
                            text: "Firma: ________________________",
                            spacing: { after: 300 }
                        }),
                        new docx.Paragraph({
                            text: "Fecha: ________________________",
                            spacing: { after: 300 }
                        })
                    ]
                }]
            });

            docx.Packer.toBlob(doc).then(blob => {
                saveAs(blob, `memoria-actuacion-${currentCalculation.protocol}-${new Date().toISOString().split('T')[0]}.docx`);
            });
        }

        // Report export functions
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const formData = getReportFormData();
            let yPosition = 20;
            
            // Header
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('DOCUMENTO DE REGISTRO DE ACTUACIONES', 20, yPosition);
            yPosition += 10;
            doc.text('PARTE DE INCIDENCIAS - PISCINA', 20, yPosition);
            yPosition += 20;
            
            // Basic info
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`HOTEL: ${formData.hotelName}`, 20, yPosition);
            doc.text(`FECHA: ${formData.incidentDate}`, 120, yPosition);
            yPosition += 10;
            doc.text(`PISCINA AFECTADA: ${formData.poolAffected}`, 20, yPosition);
            doc.text(`HORA DETECCIN: ${formData.detectionTime}`, 120, yPosition);
            yPosition += 20;
            
            // Incident type
            doc.text('TIPO DE INCIDENCIA:', 20, yPosition);
            yPosition += 8;
            formData.incidentTypes.forEach(type => {
                doc.text(` ${type}`, 25, yPosition);
                yPosition += 6;
            });
            yPosition += 10;
            
            // Description
            if (formData.incidentDescription) {
                doc.text('DESCRIPCIN DEL INCIDENTE:', 20, yPosition);
                yPosition += 8;
                const splitDescription = doc.splitTextToSize(formData.incidentDescription, 170);
                doc.text(splitDescription, 20, yPosition);
                yPosition += splitDescription.length * 6 + 10;
            }
            
            // Actions taken
            doc.text('ACTUACIONES REALIZADAS:', 20, yPosition);
            yPosition += 8;
            doc.text(`HORA CIERRE PISCINA: ${formData.poolClosureTime}`, 20, yPosition);
            yPosition += 6;
            doc.text(`PERSONAL RESPONSABLE: ${formData.responsiblePerson}`, 20, yPosition);
            yPosition += 15;
            
            // Treatment applied
            if (formData.treatments.length > 0) {
                doc.text('TRATAMIENTO APLICADO:', 20, yPosition);
                yPosition += 8;
                formData.treatments.forEach(treatment => {
                    doc.text(` ${treatment}`, 25, yPosition);
                    yPosition += 6;
                });
                yPosition += 10;
            }
            
            // Times
            doc.text('TIEMPOS:', 20, yPosition);
            yPosition += 8;
            doc.text(`INICIO TRATAMIENTO: ${formData.treatmentStart}`, 20, yPosition);
            yPosition += 6;
            doc.text(`FIN TRATAMIENTO: ${formData.treatmentEnd}`, 20, yPosition);
            yPosition += 6;
            doc.text(`HORA REAPERTURA: ${formData.reopeningTime}`, 20, yPosition);
            yPosition += 6;
            doc.text(`TIEMPO TOTAL CIERRE: ${formData.totalClosure}`, 20, yPosition);
            yPosition += 15;
            
            // Signatures
            doc.text('TCNICO RESPONSABLE:', 20, yPosition);
            yPosition += 8;
            doc.text(`${formData.technicianResponsible}`, 20, yPosition);
            yPosition += 6;
            doc.text(`FECHA: ${formData.signatureDate}`, 20, yPosition);
            yPosition += 15;
            
            doc.text('REVISADO POR DIRECCIN:', 20, yPosition);
            yPosition += 8;
            doc.text(`${formData.managementReview}`, 20, yPosition);
            yPosition += 6;
            doc.text(`FECHA: ${formData.managementDate}`, 20, yPosition);
            
            // Footer
            doc.setFontSize(8);
            doc.text('*Este documento debe conservarse m铆nimo 5 a帽os', 20, 280);
            
            // Save PDF
            const fileName = `memoria-actuacion-${formData.hotelName.replace(/\s+/g, '-')}-${formData.incidentDate}.pdf`;
            doc.save(fileName);
        }
        
        function exportToText() {
            const formData = getReportFormData();
            
            let textContent = `DOCUMENTO DE REGISTRO DE ACTUACIONES
PARTE DE INCIDENCIAS - PISCINA

HOTEL: ${formData.hotelName}
FECHA: ${formData.incidentDate}
PISCINA AFECTADA: ${formData.poolAffected}
HORA DETECCIN: ${formData.detectionTime}

TIPO DE INCIDENCIA:
${formData.incidentTypes.map(type => ` ${type}`).join('\n')}

DESCRIPCIN DEL INCIDENTE:
${formData.incidentDescription}

ACTUACIONES REALIZADAS:
HORA CIERRE PISCINA: ${formData.poolClosureTime}
PERSONAL RESPONSABLE: ${formData.responsiblePerson}

RETIRADA CONTAMINACIN:
${formData.removalMethods.map(method => ` ${method}`).join('\n')}
Observaciones: ${formData.removalObservations}

PARMETROS AGUA:
MOMENTO        | CLORO LIBRE (ppm) | pH | OBSERVACIONES
Inicial        | ${formData.chlorineInitial} | ${formData.phInitial} | ${formData.obsInitial}
1陋 Medici贸n    | ${formData.chlorine1} | ${formData.ph1} | ${formData.obs1}
2陋 Medici贸n    | ${formData.chlorine2} | ${formData.ph2} | ${formData.obs2}
3陋 Medici贸n    | ${formData.chlorine3} | ${formData.ph3} | ${formData.obs3}
Final          | ${formData.chlorineFinal} | ${formData.phFinal} | ${formData.obsFinal}

TRATAMIENTO APLICADO:
${formData.treatments.map(treatment => ` ${treatment}`).join('\n')}

SISTEMAS:
${formData.systems.map(system => ` ${system}`).join('\n')}

TIEMPOS:
INICIO TRATAMIENTO: ${formData.treatmentStart}
FIN TRATAMIENTO: ${formData.treatmentEnd}
HORA REAPERTURA: ${formData.reopeningTime}
TIEMPO TOTAL CIERRE: ${formData.totalClosure}

ANLISIS POSTERIOR:
Fecha env铆o: ${formData.sendDate}
Laboratorio: ${formData.laboratory}
Resultado: ${formData.result}
Fecha resultado: ${formData.resultDate}

COMUNICACIONES:
${formData.communications.map(comm => ` ${comm}`).join('\n')}

MEDIDAS PREVENTIVAS ADOPTADAS:
${formData.preventiveMeasures}

OBSERVACIONES ADICIONALES:
${formData.additionalObservations}

TCNICO RESPONSABLE: ${formData.technicianResponsible}
FECHA: ${formData.signatureDate}

REVISADO POR DIRECCIN:
Nombre: ${formData.managementReview}
Fecha: ${formData.managementDate}

ARCHIVO:
${formData.archives.map(archive => ` ${archive}`).join('\n')}

*Este documento debe conservarse m铆nimo 5 a帽os
`;

            navigator.clipboard.writeText(textContent).then(() => {
                showAlert('Memoria copiada al portapapeles exitosamente', 'success');
            }).catch(() => {
                showAlert('Error al copiar al portapapeles', 'error');
            });
        }
        
        function exportToWord() {
            const formData = getReportFormData();
            
            // Create a simple HTML content that can be saved as .doc
            const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Memoria de Actuaci贸n</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #1a365d; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f0f0f0; }
        .checkbox { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>DOCUMENTO DE REGISTRO DE ACTUACIONES</h1>
    <h2>PARTE DE INCIDENCIAS - PISCINA</h2>
    
    <p><strong>HOTEL:</strong> ${formData.hotelName}</p>
    <p><strong>FECHA:</strong> ${formData.incidentDate}</p>
    <p><strong>PISCINA AFECTADA:</strong> ${formData.poolAffected}</p>
    <p><strong>HORA DETECCIN:</strong> ${formData.detectionTime}</p>
    
    <h3>TIPO DE INCIDENCIA:</h3>
    ${formData.incidentTypes.map(type => `<div class="checkbox"> ${type}</div>`).join('')}
    
    <h3>DESCRIPCIN DEL INCIDENTE:</h3>
    <p>${formData.incidentDescription}</p>
    
    <h3>ACTUACIONES REALIZADAS:</h3>
    <p><strong>HORA CIERRE PISCINA:</strong> ${formData.poolClosureTime}</p>
    <p><strong>PERSONAL RESPONSABLE:</strong> ${formData.responsiblePerson}</p>
    
    <h3>PARMETROS AGUA:</h3>
    <table>
        <tr><th>MOMENTO</th><th>CLORO LIBRE (ppm)</th><th>pH</th><th>OBSERVACIONES</th></tr>
        <tr><td>Inicial</td><td>${formData.chlorineInitial}</td><td>${formData.phInitial}</td><td>${formData.obsInitial}</td></tr>
        <tr><td>1陋 Medici贸n</td><td>${formData.chlorine1}</td><td>${formData.ph1}</td><td>${formData.obs1}</td></tr>
        <tr><td>2陋 Medici贸n</td><td>${formData.chlorine2}</td><td>${formData.ph2}</td><td>${formData.obs2}</td></tr>
        <tr><td>3陋 Medici贸n</td><td>${formData.chlorine3}</td><td>${formData.ph3}</td><td>${formData.obs3}</td></tr>
        <tr><td>Final</td><td>${formData.chlorineFinal}</td><td>${formData.phFinal}</td><td>${formData.obsFinal}</td></tr>
    </table>
    
    <h3>TRATAMIENTO APLICADO:</h3>
    ${formData.treatments.map(treatment => `<div class="checkbox"> ${treatment}</div>`).join('')}
    
    <h3>TIEMPOS:</h3>
    <p><strong>INICIO TRATAMIENTO:</strong> ${formData.treatmentStart}</p>
    <p><strong>FIN TRATAMIENTO:</strong> ${formData.treatmentEnd}</p>
    <p><strong>HORA REAPERTURA:</strong> ${formData.reopeningTime}</p>
    <p><strong>TIEMPO TOTAL CIERRE:</strong> ${formData.totalClosure}</p>
    
    <h3>TCNICO RESPONSABLE:</h3>
    <p>${formData.technicianResponsible}</p>
    <p><strong>FECHA:</strong> ${formData.signatureDate}</p>
    
    <h3>REVISADO POR DIRECCIN:</h3>
    <p><strong>Nombre:</strong> ${formData.managementReview}</p>
    <p><strong>Fecha:</strong> ${formData.managementDate}</p>
    
    <p><em>*Este documento debe conservarse m铆nimo 5 a帽os</em></p>
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `memoria-actuacion-${formData.hotelName.replace(/\s+/g, '-')}-${formData.incidentDate}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function getReportFormData() {
            const form = document.getElementById('incident-report-form');
            const formData = new FormData(form);
            
            // Get checked incident types
            const incidentTypes = [];
            form.querySelectorAll('input[name="incident-type"]:checked').forEach(checkbox => {
                if (checkbox.value === 'otro') {
                    incidentTypes.push(`Otro: ${document.getElementById('other-incident').value}`);
                } else {
                    incidentTypes.push(checkbox.nextSibling.textContent.trim());
                }
            });
            
            // Get removal methods
            const removalMethods = [];
            form.querySelectorAll('input[name="removal-method"]:checked').forEach(checkbox => {
                removalMethods.push(checkbox.nextSibling.textContent.trim());
            });
            if (form.querySelector('input[name="material-disinfected"]:checked')) {
                removalMethods.push('Material desinfectado con lej铆a');
            }
            
            // Get treatments
            const treatments = [];
            form.querySelectorAll('input[name="treatment"]:checked').forEach(checkbox => {
                if (checkbox.value === 'hyperchlorination') {
                    const ppm = form.querySelector('input[name="chlorination-ppm"]').value || '_____';
                    const hours = form.querySelector('input[name="chlorination-hours"]').value || '_____';
                    treatments.push(`Hipercloraci贸n: ${ppm} ppm durante ${hours} horas`);
                } else if (checkbox.value === 'other-treatment') {
                    const desc = form.querySelector('input[name="other-treatment-desc"]').value || '';
                    treatments.push(`Otro: ${desc}`);
                } else {
                    treatments.push(checkbox.nextSibling.textContent.trim());
                }
            });
            
            // Get systems
            const systems = [];
            form.querySelectorAll('input[name="systems"]:checked').forEach(checkbox => {
                systems.push(checkbox.nextSibling.textContent.trim());
            });
            
            // Get communications
            const communications = [];
            form.querySelectorAll('input[name="communications"]:checked').forEach(checkbox => {
                communications.push(checkbox.nextSibling.textContent.trim());
            });
            
            // Get archives
            const archives = [];
            form.querySelectorAll('input[name="archive"]:checked').forEach(checkbox => {
                archives.push(checkbox.nextSibling.textContent.trim());
            });
            
            return {
                hotelName: formData.get('hotel-name') || '',
                incidentDate: formData.get('incident-date') || '',
                poolAffected: formData.get('pool-affected') || '',
                detectionTime: formData.get('detection-time') || '',
                incidentTypes,
                incidentDescription: formData.get('incident-description') || '',
                poolClosureTime: formData.get('pool-closure-time') || '',
                responsiblePerson: formData.get('responsible-person') || '',
                removalMethods,
                removalObservations: formData.get('removal-observations') || '',
                chlorineInitial: formData.get('chlorine-initial') || '',
                phInitial: formData.get('ph-initial') || '',
                obsInitial: formData.get('obs-initial') || '',
                chlorine1: formData.get('chlorine-1') || '',
                ph1: formData.get('ph-1') || '',
                obs1: formData.get('obs-1') || '',
                chlorine2: formData.get('chlorine-2') || '',
                ph2: formData.get('ph-2') || '',
                obs2: formData.get('obs-2') || '',
                chlorine3: formData.get('chlorine-3') || '',
                ph3: formData.get('ph-3') || '',
                obs3: formData.get('obs-3') || '',
                chlorineFinal: formData.get('chlorine-final') || '',
                phFinal: formData.get('ph-final') || '',
                obsFinal: formData.get('obs-final') || '',
                treatments,
                systems,
                treatmentStart: formData.get('treatment-start') || '',
                treatmentEnd: formData.get('treatment-end') || '',
                reopeningTime: formData.get('reopening-time') || '',
                totalClosure: formData.get('total-closure') || '',
                sendDate: formData.get('send-date') || '',
                laboratory: formData.get('laboratory') || '',
                result: formData.get('result') || '',
                resultDate: formData.get('result-date') || '',
                communications,
                preventiveMeasures: formData.get('preventive-measures') || '',
                additionalObservations: formData.get('additional-observations') || '',
                technicianResponsible: formData.get('technician-responsible') || '',
                signatureDate: formData.get('signature-date') || '',
                managementReview: formData.get('management-review') || '',
                managementDate: formData.get('management-date') || '',
                archives
            };
        }

        // Orders system variables and functions
        const chemicalProducts = [
            "SAL DESCALCIFICADOR PASTILLAS 25KG",
            "HIPOCLORITO PISCINAS",
            "DISMINUIDOR PH LIQUIDO AQUA PEDROSA 23KG",
            "ACIDO CLORHIDRICO 32% CONS.HUMANO 23KG",
            "REACTIVO FOTOMETRO DPD-1 C/250UN",
            "REACTIVO FOTOMETRO DPD-3 C/250UN",
            "REACTIVO FOTOMETRO PH (PHENOL RED) C/250UN",
            "LEJIA ALIMENTARIA 40GR/L 22KG",
            "ANTIINCRUSTANTE QUIMIFOS GFA 20L",
            "ESTABILIZANTE CTX-400",
            "DESENGRASANTE CTX-75",
            "CLORO GRANULADO CTX-300",
            "BROMO TABLETAS CUBO 20KG",
            "COAGULANTE GOLDENFLOK GFA 5KG",
            "ALGIBLACK GFA 5KG",
            "REACTIVO ISOCIANURICO",
            "NEUTRALIZANTE CTX-12"
        ];

        function initializeOrders() {
            // Set current date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('orderDate').value = today;
            
            // Generate products table
            generateOrdersTable();
            
            // Initialize stats
            updateOrderStats();
        }

        function generateOrdersTable() {
            const tableBody = document.getElementById('productsTable');
            tableBody.innerHTML = '';

            chemicalProducts.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="product-name">${product}</td>
                    <td class="hotel-column" style="text-align: center;">
                        <input type="number" class="quantity-input" 
                               id="wave_${index}" 
                               min="0" 
                               placeholder="0"
                               onchange="updateOrderStats(); updateOrderSummaryAuto()">
                    </td>
                    <td class="hotel-column" style="text-align: center;">
                        <input type="number" class="quantity-input" 
                               id="sky_${index}" 
                               min="0" 
                               placeholder="0"
                               onchange="updateOrderStats(); updateOrderSummaryAuto()">
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateOrderStats() {
            let waveCount = 0;
            let skyCount = 0;

            chemicalProducts.forEach((product, index) => {
                const waveQty = document.getElementById(`wave_${index}`).value;
                const skyQty = document.getElementById(`sky_${index}`).value;

                if (waveQty && parseInt(waveQty) > 0) {
                    waveCount++;
                }

                if (skyQty && parseInt(skyQty) > 0) {
                    skyCount++;
                }
            });

            const totalCount = waveCount + skyCount;

            document.getElementById('waveCount').textContent = waveCount;
            document.getElementById('skyCount').textContent = skyCount;
            document.getElementById('totalCount').textContent = totalCount;

            // Show/hide stats bar
            const statsBar = document.getElementById('statsBar');
            if (totalCount > 0) {
                statsBar.classList.add('show');
            } else {
                statsBar.classList.remove('show');
            }
        }

        function generateOrderSummary() {
            const orderDate = document.getElementById('orderDate').value;
            const dateFormatted = orderDate ? new Date(orderDate).toLocaleDateString('es-ES') : 'Sin fecha';
            
            let waveItems = [];
            let skyItems = [];

            chemicalProducts.forEach((product, index) => {
                const waveQty = document.getElementById(`wave_${index}`).value;
                const skyQty = document.getElementById(`sky_${index}`).value;

                if (waveQty && parseInt(waveQty) > 0) {
                    waveItems.push(` ${product}: ${waveQty}`);
                }

                if (skyQty && parseInt(skyQty) > 0) {
                    skyItems.push(` ${product}: ${skyQty}`);
                }
            });

            let summary = ` PEDIDO QUMICOS PISCINAS\n`;
            summary += ` Fecha: ${dateFormatted}\n\n`;

            if (waveItems.length > 0) {
                summary += ` HOTEL WAVE:\n`;
                summary += waveItems.join('\n') + '\n\n';
            } else {
                summary += ` HOTEL WAVE: Sin pedidos\n\n`;
            }

            if (skyItems.length > 0) {
                summary += `锔 HOTEL SKY:\n`;
                summary += skyItems.join('\n') + '\n\n';
            } else {
                summary += `锔 HOTEL SKY: Sin pedidos\n\n`;
            }

            summary += ` Total productos Wave: ${waveItems.length}\n`;
            summary += ` Total productos Sky: ${skyItems.length}\n`;
            summary += `\n Pedido generado autom谩ticamente`;

            document.getElementById('ordersSummaryContent').textContent = summary;
            document.getElementById('ordersSummary').classList.add('show');
            
            // Scroll to summary
            document.getElementById('ordersSummary').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });

            showOrderToast('Resumen generado correctamente');
            return summary;
        }

        function updateOrderSummaryAuto() {
            // Auto-update summary if visible
            if (document.getElementById('ordersSummary').classList.contains('show')) {
                generateOrderSummary();
            }
        }

        function shareOrderWhatsApp() {
            const summary = generateOrderSummary();
            const encodedMessage = encodeURIComponent(summary);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
            
            showOrderToast('Abriendo WhatsApp...');
        }

        function clearOrderForm() {
            if (confirm('驴Est谩s seguro de que quieres limpiar todo el formulario?')) {
                // Clear all quantities
                chemicalProducts.forEach((product, index) => {
                    document.getElementById(`wave_${index}`).value = '';
                    document.getElementById(`sky_${index}`).value = '';
                });

                // Hide summary
                document.getElementById('ordersSummary').classList.remove('show');

                // Reset date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('orderDate').value = today;

                // Update stats
                updateOrderStats();

                showOrderToast('Formulario limpiado correctamente');
            }
        }

        function showOrderToast(message) {
            // Create or get toast element
            let toast = document.getElementById('orderToast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'orderToast';
                toast.className = 'toast';
                document.body.appendChild(toast);
            }

            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function copyToClipboard() {
            if (!currentCalculation) {
                showAlert('No hay c谩lculos para copiar', 'error');
                return;
            }

            const protocolNames = {
                'solid-feces': 'Heces S贸lidas',
                'liquid-feces': 'Heces L铆quidas/Diarrea - Hipercloraci贸n',
                'vomit': 'V贸mitos',
                'pseudomonas': 'Pseudomonas Aeruginosa',
                'chlorine': 'Correcci贸n Cloro Libre',
                'ph-up': 'Correcci贸n pH - Subir',
                'ph-down': 'Correcci贸n pH - Bajar'
            };

            let textContent = `MEMORIA DE ACTUACIN - PISCINA
============================================

Fecha: ${new Date().toLocaleDateString('es-ES')}
Hora: ${new Date().toLocaleTimeString('es-ES')}

PROTOCOLO: ${protocolNames[currentCalculation.protocol]}

DATOS DEL CLCULO:
- Volumen de la piscina: ${currentCalculation.volume} m鲁
- Producto utilizado: ${currentCalculation.product}
- Cantidad necesaria: ${currentCalculation.amount} ${currentCalculation.unit}
- Dosis por m鲁: ${currentCalculation.dosePerM3} ${currentCalculation.unit}/m鲁
- Tiempo de tratamiento: ${currentCalculation.treatmentTime}

PROTOCOLO DE ACTUACIN:
`;

            currentCalculation.steps.forEach((step, index) => {
                textContent += `${index + 1}. ${step.replace(/<[^>]*>/g, '')}\n`;
            });

            textContent += `
TCNICO RESPONSABLE:
Nombre: ________________________
Firma: ________________________
Fecha: ________________________

============================================
Documento generado por Sistema de Protocolos Piscinas Pedrosa
`;

            navigator.clipboard.writeText(textContent).then(() => {
                showAlert('Texto copiado al portapapeles exitosamente', 'success');
            }).catch(() => {
                showAlert('Error al copiar al portapapeles', 'error');
            });
        }
    </script>
</body>
</html>
